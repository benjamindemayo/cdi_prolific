---
title: "Full dataset analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(png)
library(knitr)
library(markdown)
library(lmerTest)
library(ggthemes)
library(psych)
library(magrittr)
library(tidyboot)
library(fs)
library(ggmap)
library(lubridate)

source(path(here::here(), "file_paths.R"))
source(functions_script)

#Variables to tinker with
min_completion_time = 8.5
```

First read in all of the relevant data.

```{r}
all_ws_1 <- 
  readInWebCDI(all_data_ws1_path) %>% 
  select( #drop a bunch of columns that were screwing up the merge with prolific data
    -opt_out,
    -country,
    -sibling_boolean,
    -sibling_data,
    -sibling_count,
    -caregiver_other
  )

all_ws_2 <- 
  readInWebCDI(all_data_ws2_path) %>% 
  select( #drop a bunch of columns that were screwing up the merge with prolific data
    -opt_out,
    -country,
    -sibling_boolean,
    -sibling_data,
    -sibling_count,
    -caregiver_other
  )

all_ws_raw <- 
  all_ws_1 %>% 
  bind_rows(all_ws_2) %>% 
  mutate(completed = case_when(
    stringr::str_to_lower(completed) == "true" ~ TRUE,
    stringr::str_to_lower(completed) == "false" ~ FALSE
  ))

all_wg_raw <- readInWebCDI(all_data_wg_path)
```

```{r}
hearing_vision_issues <- 
  all_wg_raw %>% 
  mutateVision() %>% 
  filter(has_vision_issue | has_hearing_issue) %>% 
  select(
    subject_id, 
    study_name,
    vision_problems_boolean,
    vision_problems, 
    hearing_loss_boolean,
    hearing_loss, 
    has_vision_issue, 
    has_hearing_issue
  )

#gives only the rows that have a narrative response in them
narrative_responses_ws <- 
  all_ws_raw %>% 
  select(
    subject_id,
    study_name,
    ear_infections,
    hearing_loss,
    vision_problems,
    illnesses,
    services,
    worried,
    learning_disability
  ) %>% 
  rowwise() %>% 
  mutate(
    all_na = all(is.na(c_across(!c(subject_id, study_name))))
  ) %>% 
  filter(!all_na)





```

