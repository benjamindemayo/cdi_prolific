count(maternal_ed) %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
left_join(old_momed_numbers, by = "maternal_ed") %>%
left_join(census_momed_numbers, by = "maternal_ed") %>%
select(-n) %>%
pivot_longer(
cols = c(
`Dataset 1: Full Web-CDI sample`,
`2007 manual`,
`U.S. Census Estimates`
),
names_to = "study",
values_to = "proportion"
) %>%
mutate(
maternal_ed = fct_relevel(
maternal_ed,
"Some high school or less",
"High school diploma",
"Some college education",
"College diploma or more"
)
) %>%
mutate(study = fct_relevel(
study,
"Dataset 1: Full Web-CDI sample",
"2007 manual",
"U.S. Census Estimates"
))
x_axis_labs <- c(
"Some high school\n or less",
"High school\ndiploma",
"Some college\neducation",
"College diploma\nor more"
)
maternal_ed_plot <-
maternal_ed_plot_df %>%
filter(maternal_ed != "Not reported") %>%
ggplot(aes(maternal_ed, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(x = "Primary caregiver education") +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(angle = 25, vjust = 0.9, hjust = 1)
) +
scale_x_discrete(labels = x_axis_labs) +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
plot1 <-
ethnicity_plot +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 0, b = 5)),
axis.text = element_text(size = 15),
axis.title = element_text(size = 15),
)
plot2 <-
maternal_ed_plot +
ylab(NULL) +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 2, b = 5)),
axis.text = element_text(size = 15),
axis.title = element_text(size = 15)
)
plot3 <-
white_hispanic_plot +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 2, t = 3)),
axis.text = element_text(size = 15),
axis.title = element_text(
size = 15
),
axis.title.x = element_blank()
)
#align the plots vertically
all_demo_plots <-
align_plots(plot1, plot2, plot3, align = "V", axis = 'l')
toprow <-
cowplot::plot_grid(
all_demo_plots[[1]],
all_demo_plots[[2]],
align = "hv",
labels = c("A", "B")
)
legend <-
get_legend(
ethnicity_plot +
# guides(color = guide_legend(nrow = 1)) +
# theme(legend.position = "bottom")
theme(
legend.box.margin = margin(0, 0, 0, 15),
legend.text = element_text(size = 18)
)
)
bottomrow <-
plot_grid(
all_demo_plots[[3]],
legend,
labels = c("C"),
nrow = 1
)
demo_barplot <-
plot_grid(toprow, bottomrow, ncol = 1)
ggsave(
"demo_barplot.png",
plot = demo_barplot,
path = fig_directory,
width = 11,
height = 8
)
demo_barplot_caption <-
str_c(
"Top row: Proportion of respondents plotted by child race (A) and educational level of primary caregiver (B) from full Web-CDI sample (Dataset 1) to date (N = ",
formatC(filtered_n_total, big.mark = ",", big.interval = 3),
"), compared with norming sample demographics from Fenson (2007) and U.S. Census data (American Community Survey 2019).\nBottom row (C): Participant breakdown by race in Dataset 1 as compared with U.S. Census data, splitting white participants into those who are Hispanic and those are not."
)
plot3
white_hispanic_plot <-
whites_vs_census %>%
ggplot(aes(ethnicity, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(
y = "Proportion of\nrespondents"
) +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(
angle = 25,
vjust = 0.9,
hjust = 1
)
) +
labs(x = "Race") +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
white_hispanic_plot
whites_vs_census <-
demographics_df %>%
mutate(ethnicity = as.character(ethnicity)) %>%
mutate(ethnicity = factor(case_when(
ethnicity == "White" & !hispanic ~ "White, non-Hispanic",
ethnicity == "White" & hispanic ~ "White, Hispanic",
TRUE ~ ethnicity
))) %>%
count(ethnicity) %>%
filter(ethnicity != "No ethnicity reported") %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
left_join(census_ethnicity_hispanic_white, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(
`Dataset 1: Full Web-CDI sample`,
`U.S. Census Estimates`
),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
levels = c("U.S. Census Estimates", "Dataset 1: Full Web-CDI sample")
))
white_hispanic_plot <-
whites_vs_census %>%
ggplot(aes(ethnicity, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(
y = "Proportion of\nrespondents"
) +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(
angle = 25,
vjust = 0.9,
hjust = 1
)
) +
labs(x = "Race") +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
white_hispanic_plot
#tibble for ethnicity plot
ethnicity_plot_df <-
demographics_df %>%
getEthnicitySummary() %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
filter(ethnicity != "No ethnicity reported") %>%
left_join(old_ethnicity_numbers, by = "ethnicity") %>%
left_join(census_ethnicity_numbers, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(`Dataset 1: Full Web-CDI sample`, `2007 manual`, `U.S. Census Estimates`),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
"Dataset 1: Full Web-CDI sample",
"2007 manual",
"U.S. Census Estimates"
))
whites_vs_census <-
demographics_df %>%
mutate(ethnicity = as.character(ethnicity)) %>%
mutate(ethnicity = factor(case_when(
ethnicity == "White" & !hispanic ~ "White, non-Hispanic",
ethnicity == "White" & hispanic ~ "White, Hispanic",
TRUE ~ ethnicity
))) %>%
count(ethnicity) %>%
filter(ethnicity != "No ethnicity reported") %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
left_join(census_ethnicity_hispanic_white, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(
`Dataset 1: Full Web-CDI sample`,
`U.S. Census Estimates`
),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
levels = c("Dataset 1: Web-CDI sample", "U.S. Census Estimates")
))
whites_vs_census <-
demographics_df %>%
mutate(ethnicity = as.character(ethnicity)) %>%
mutate(ethnicity = factor(case_when(
ethnicity == "White" & !hispanic ~ "White, non-Hispanic",
ethnicity == "White" & hispanic ~ "White, Hispanic",
TRUE ~ ethnicity
))) %>%
count(ethnicity) %>%
filter(ethnicity != "No ethnicity reported") %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
left_join(census_ethnicity_hispanic_white, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(
`Dataset 1: Full Web-CDI sample`,
`U.S. Census Estimates`
),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
levels = c("Dataset 1: Full Web-CDI sample", "U.S. Census Estimates")
))
white_hispanic_plot <-
whites_vs_census %>%
ggplot(aes(ethnicity, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(
y = "Proportion of\nrespondents"
) +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(
angle = 25,
vjust = 0.9,
hjust = 1
)
) +
labs(x = "Race") +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
white_hispanic_plot
#demographic information of the entire sample
demographics_df <-
bind_rows(
wg_filtered %>%
mutate(hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == "TRUE") %>%
select(
study_name,
subject_id,
age,
ethnicity,
maternal_ed,
produced,
sex,
hispanic
),
ws_filtered %>%
mutate(hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == "TRUE") %>%
select(
study_name,
subject_id,
age,
ethnicity,
maternal_ed,
produced,
sex,
hispanic
)
)
#tibble for ethnicity plot
ethnicity_plot_df <-
demographics_df %>%
getEthnicitySummary() %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
filter(ethnicity != "No ethnicity reported") %>%
left_join(old_ethnicity_numbers, by = "ethnicity") %>%
left_join(census_ethnicity_numbers, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(`Dataset 1: Full Web-CDI sample`, `2007 manual`, `U.S. Census Estimates`),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
"Dataset 1: Full Web-CDI sample",
"2007 manual",
"U.S. Census Estimates"
))
#ethnicity plot
ethnicity_plot <-
ethnicity_plot_df %>%
ggplot(aes(ethnicity, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(
y = "Proportion of\nrespondents"
) +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(
angle = 25,
vjust = 0.9,
hjust = 1
)
) +
labs(x = "Race") +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
#tibble for eth plot with white hispanic breakdown
whites_vs_census <-
demographics_df %>%
mutate(ethnicity = as.character(ethnicity)) %>%
mutate(ethnicity = factor(case_when(
ethnicity == "White" & !hispanic ~ "White, non-Hispanic",
ethnicity == "White" & hispanic ~ "White, Hispanic",
TRUE ~ ethnicity
))) %>%
count(ethnicity) %>%
filter(ethnicity != "No ethnicity reported") %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
left_join(census_ethnicity_hispanic_white, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(
`Dataset 1: Full Web-CDI sample`,
`U.S. Census Estimates`
),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
levels = c("Dataset 1: Full Web-CDI sample", "U.S. Census Estimates")
))
white_hispanic_plot <-
whites_vs_census %>%
ggplot(aes(ethnicity, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(
y = "Proportion of\nrespondents"
) +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(
angle = 25,
vjust = 0.9,
hjust = 1
)
) +
labs(x = "Race") +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
white_hispanic_plot
maternal_ed_plot_df <-
demographics_df %>%
count(maternal_ed) %>%
mutate(`Dataset 1: Full Web-CDI sample` = prop.table(n)) %>%
left_join(old_momed_numbers, by = "maternal_ed") %>%
left_join(census_momed_numbers, by = "maternal_ed") %>%
select(-n) %>%
pivot_longer(
cols = c(
`Dataset 1: Full Web-CDI sample`,
`2007 manual`,
`U.S. Census Estimates`
),
names_to = "study",
values_to = "proportion"
) %>%
mutate(
maternal_ed = fct_relevel(
maternal_ed,
"Some high school or less",
"High school diploma",
"Some college education",
"College diploma or more"
)
) %>%
mutate(study = fct_relevel(
study,
"Dataset 1: Full Web-CDI sample",
"2007 manual",
"U.S. Census Estimates"
))
x_axis_labs <- c(
"Some high school\n or less",
"High school\ndiploma",
"Some college\neducation",
"College diploma\nor more"
)
maternal_ed_plot <-
maternal_ed_plot_df %>%
filter(maternal_ed != "Not reported") %>%
ggplot(aes(maternal_ed, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(x = "Primary caregiver education") +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(angle = 25, vjust = 0.9, hjust = 1)
) +
scale_x_discrete(labels = x_axis_labs) +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
plot1 <-
ethnicity_plot +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 0, b = 5)),
axis.text = element_text(size = 15),
axis.title = element_text(size = 15),
)
plot2 <-
maternal_ed_plot +
ylab(NULL) +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 2, b = 5)),
axis.text = element_text(size = 15),
axis.title = element_text(size = 15)
)
plot3 <-
white_hispanic_plot +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 2, t = 3)),
axis.text = element_text(size = 15),
axis.title = element_text(
size = 15
),
axis.title.x = element_blank()
)
#align the plots vertically
all_demo_plots <-
align_plots(plot1, plot2, plot3, align = "V", axis = 'l')
toprow <-
cowplot::plot_grid(
all_demo_plots[[1]],
all_demo_plots[[2]],
align = "hv",
labels = c("A", "B")
)
legend <-
get_legend(
ethnicity_plot +
# guides(color = guide_legend(nrow = 1)) +
# theme(legend.position = "bottom")
theme(
legend.box.margin = margin(0, 0, 0, 15),
legend.text = element_text(size = 18)
)
)
bottomrow <-
plot_grid(
all_demo_plots[[3]],
legend,
labels = c("C"),
nrow = 1
)
demo_barplot <-
plot_grid(toprow, bottomrow, ncol = 1)
ggsave(
"demo_barplot.png",
plot = demo_barplot,
path = fig_directory,
width = 11,
height = 8
)
demo_barplot_caption <-
str_c(
"Top row: Proportion of respondents plotted by child race (A) and educational level of primary caregiver (B) from full Web-CDI sample (Dataset 1) to date (N = ",
formatC(filtered_n_total, big.mark = ",", big.interval = 3),
"), compared with norming sample demographics from Fenson (2007) and U.S. Census data (American Community Survey 2019).\nBottom row (C): Participant breakdown by race in Dataset 1 as compared with U.S. Census data, splitting white participants into those who are Hispanic and those are not."
)
install.packages("rmdfiltr")
?kbl
