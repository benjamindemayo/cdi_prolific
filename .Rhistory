unfiltered_n_total <- unfiltered_n_ws + unfiltered_n_wg
#number of administrations after exclusions
filtered_n_wg <- nrow(wg_filtered)
filtered_n_ws <- nrow(ws_filtered)
filtered_n_total <- filtered_n_wg + filtered_n_ws
#number of exclusions_
exclusions_n_wg <- unfiltered_n_wg - filtered_n_wg
exclusions_n_ws <- unfiltered_n_ws - filtered_n_ws
exclusions_n_total <- unfiltered_n_total - filtered_n_total
load(full_sample_exclusions)
exclusion_tbl_full %>%
kbl(
booktabs = TRUE,
linesep = "",
caption = "Exclusions from full WebCDI sample"
) %>%
kable_styling(
position = "center"
) %>%
column_spec(1, width = "2.4in") %>%
column_spec(2:5, width = "1in") %>%
row_spec(0, bold = TRUE)
options_table <-
read_csv(
path(
project_root,
"paper",
"options_table",
ext = "csv"
)
) %>%
filter(!is.na(`Study setting`))
View(options_table)
options_table <-
read_csv(
path(
project_root,
"paper",
"options_table",
ext = "csv"
)
) %>%
filter(!is.na(`Study setting`)) %>%
mutate(
Notes = case_when(
is.na(`Notes`) ~ "--",
TRUE ~ `Notes`
)
)
library(papaja)
library(tidyverse)
library(fs)
library(xtable)
library(kableExtra)
library(cowplot)
library(scales)
library(estimatr)
library(broman)
source(path(here::here(), "file_paths.R"))
source(functions_script)
options_table <-
read_csv(
path(
project_root,
"paper",
"options_table",
ext = "csv"
)
) %>%
filter(!is.na(`Study setting`)) %>%
mutate(
Notes = case_when(
is.na(`Notes`) ~ "--",
TRUE ~ `Notes`
)
)
options_table %>%
kbl(
booktabs = TRUE,
longtable = TRUE,
linesep = "",
caption = "Settings customizable by researchers when creating new studies to be run on the Web-CDI platform."
) %>%
kable_styling(
position = "center",
latex_options = c("scale_down", "repeat_header")
) %>%
column_spec(c(1, 3), width = "2.2in") %>%
column_spec(2, width = "1.2in") %>%
row_spec(0, bold = TRUE)
#papaja::render_appendix("appendix_options_table.Rmd")
source(functions_script)
library(papaja)
library(tidyverse)
library(fs)
library(xtable)
library(kableExtra)
library(cowplot)
library(scales)
library(estimatr)
library(broman)
source(path(here::here(), "file_paths.R"))
source(functions_script)
options_table <-
read_csv(
path(
project_root,
"paper",
"options_table",
ext = "csv"
)
) %>%
filter(!is.na(`Study setting`))
View(options_table)
library(papaja)
library(tidyverse)
library(fs)
library(xtable)
library(kableExtra)
library(cowplot)
library(scales)
library(estimatr)
library(broman)
source(path(here::here(), "file_paths.R"))
source(functions_script)
options_table <-
read_csv(
path(
project_root,
"paper",
"options_table",
ext = "csv"
)
) %>%
filter(!is.na(`Study setting`)) %>%
mutate(
Notes = case_when(
is.na(`Notes`) ~ "--",
TRUE ~ `Notes`
)
)
library(papaja)
library(tidyverse)
library(fs)
library(xtable)
library(kableExtra)
library(cowplot)
library(scales)
library(estimatr)
library(broman)
source(path(here::here(), "file_paths.R"))
source(functions_script)
#Read in (somewhat) preprocessed forms of the data
load(wg_unfiltered_path)
load(ws_unfiltered_path)
load(wg_filtered_path)
load(ws_filtered_path)
load(wg_unfiltered_ses_path)
load(ws_unfiltered_ses_path)
load(wg_filtered_ses_path)
load(ws_filtered_ses_path)
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed, warning = FALSE, message = FALSE)
img <- png::readPNG(path(fig_directory, "pictorial_instructions.png"))
grid::grid.raster(img)
img <- png::readPNG(path(fig_directory, "cdi_instructions.png"))
grid::grid.raster(img)
#number of administrations before exclusions
unfiltered_n_wg <- nrow(all_wg_raw)
unfiltered_n_ws <- nrow(all_wg_raw)
unfiltered_n_total <- unfiltered_n_ws + unfiltered_n_wg
#number of administrations after exclusions
filtered_n_wg <- nrow(wg_filtered)
filtered_n_ws <- nrow(ws_filtered)
filtered_n_total <- filtered_n_wg + filtered_n_ws
#number of exclusions_
exclusions_n_wg <- unfiltered_n_wg - filtered_n_wg
exclusions_n_ws <- unfiltered_n_ws - filtered_n_ws
exclusions_n_total <- unfiltered_n_total - filtered_n_total
load(full_sample_exclusions)
exclusion_tbl_full %>%
kbl(
booktabs = TRUE,
linesep = "",
caption = "Exclusions from full Web-CDI sample"
) %>%
kable_styling(
position = "center"
) %>%
column_spec(1, width = "2.4in") %>%
column_spec(2:5, width = "1in") %>%
row_spec(0, bold = TRUE)
#demographic information of the entire sample
demographics_df <-
bind_rows(
wg_filtered %>%
select(
study_name,
subject_id,
age,
ethnicity,
maternal_ed,
produced,
sex
),
ws_filtered %>%
select(
study_name,
subject_id,
age,
ethnicity,
maternal_ed,
produced,
sex
)
)
#tibble for ethnicity plot
ethnicity_plot_df <-
demographics_df %>%
getEthnicitySummary() %>%
mutate(`Web-CDI sample` = prop.table(n)) %>%
filter(ethnicity != "No ethnicity reported") %>%
left_join(old_ethnicity_numbers, by = "ethnicity") %>%
left_join(census_ethnicity_numbers, by = "ethnicity") %>%
select(-n) %>%
pivot_longer(
cols = c(`Web-CDI sample`, `2007 manual`, `U.S. Census Estimates`),
names_to = "study",
values_to = "proportion"
) %>%
mutate(study = fct_relevel(
study,
"Web-CDI sample",
"2007 manual",
"U.S. Census Estimates"
))
#ethnicity plot
ethnicity_plot <-
ethnicity_plot_df %>%
ggplot(aes(ethnicity, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(
y = "Proportion of\nrespondents"
) +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(
angle = 25,
vjust = 0.9,
hjust = 1
)
) +
labs(x = "Race") +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
maternal_ed_plot_df <-
demographics_df %>%
count(maternal_ed) %>%
mutate(`Web-CDI sample` = prop.table(n)) %>%
left_join(old_momed_numbers, by = "maternal_ed") %>%
left_join(census_momed_numbers, by = "maternal_ed") %>%
select(-n) %>%
pivot_longer(
cols = c(`Web-CDI sample`, `2007 manual`, `U.S. Census Estimates`),
names_to = "study",
values_to = "proportion"
) %>%
mutate(
maternal_ed = fct_relevel(
maternal_ed,
"Some high school or less",
"High school diploma",
"Some college education",
"College diploma or more"
)
) %>%
mutate(study = fct_relevel(
study,
"Web-CDI sample",
"2007 manual",
"U.S. Census Estimates"
))
x_axis_labs <- c(
"Some high school\n or less",
"High school\ndiploma",
"Some college\neducation",
"College diploma\nor more"
)
maternal_ed_plot <-
maternal_ed_plot_df %>%
filter(maternal_ed != "Not reported") %>%
ggplot(aes(maternal_ed, proportion, fill = study)) +
geom_col(position = "dodge") +
labs(x = "Primary caregiver education") +
ggthemes::theme_few() +
theme(
legend.title = element_blank(),
axis.text.x = element_text(angle = 25, vjust = 0.9, hjust = 1)
) +
scale_x_discrete(labels = x_axis_labs) +
scale_fill_viridis_d() +
coord_cartesian(ylim = c(0, .81))
prow <- cowplot::plot_grid(
ethnicity_plot +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 0)),
axis.text = element_text(size = 15),
axis.title = element_text(size = 15)
),
maternal_ed_plot +
ylab(NULL) +
theme(
legend.position = "none",
plot.margin = (margin(r = 2, l = 2)),
axis.text = element_text(size = 15),
axis.title = element_text(size = 15)
),
align = "hv",
labels = c("A", "B")
)
legend <-
get_legend(
ethnicity_plot +
# guides(color = guide_legend(nrow = 1)) +
# theme(legend.position = "bottom")
theme(
legend.box.margin = margin(0, 0, 0, 15),
legend.text = element_text(size = 15),
legend.position = "bottom"
)
)
demo_barplot <- plot_grid(prow, legend, ncol = 1, rel_heights = c(1, .1))
ggsave(
"demo_barplot.png",
plot = demo_barplot,
path = fig_directory,
width = 12,
height = 8
)
demo_barplot_caption <-
str_c(
"Proportion of respondents plotted by child race (A) and educational level of primary caregiver (B) from full Web-CDI sample to date (N = ",
formatC(filtered_n_total, big.mark = ",", big.interval = 3),
"), compared with norming sample demographics from Fenson (2007). Latinx participants can be of any race and are thus not represented as a separate category here."
)
img_2 <- png::readPNG(path(fig_directory, "demo_barplot.png"))
grid::grid.raster(img_2)
#Hispanic proportions
wg_hispanic <-
wg_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
ws_hispanic <-
ws_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic)%>%
mutate(prop = n / sum(n))
wg_hispanic_percent <-
wg_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
ws_hispanic_percent <-
ws_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
View(wg_hispanic)
wg_all_hispanic <-
wg_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
View(wg_all_hispanic)
wg_all_hispanic <-
all_wg_raw %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
View(wg_all_hispanic)
ws_all_hispanic <-
all_ws_raw %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
View(ws_all_hispanic)
#Hispanic proportions
wg_hispanic <-
wg_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
ws_hispanic <-
ws_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic)%>%
mutate(prop = n / sum(n))
wg_hispanic_percent <-
wg_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
ws_hispanic_percent <-
ws_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
##hispanic tables before exclusions
wg_all_hispanic <-
all_wg_raw %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
ws_all_hispanic <-
all_ws_raw %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
wg_all_hispanic_percent <-
wg_all_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
ws_all_hispanic_percent <-
ws_all_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
#Hispanic proportions
wg_hispanic <-
wg_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
ws_hispanic <-
ws_filtered %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic)%>%
mutate(prop = n / sum(n))
wg_hispanic_percent <-
wg_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
ws_hispanic_percent <-
ws_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
##hispanic tables before exclusions
wg_all_hispanic <-
all_wg_raw %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
ws_all_hispanic <-
all_ws_raw %>%
mutate(
hispanic = !is.na(child_hispanic_latino) & child_hispanic_latino == TRUE
) %>%
count(hispanic) %>%
mutate(prop = n / sum(n))
wg_all_hispanic_percent <-
wg_all_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
ws_all_hispanic_percent <-
ws_all_hispanic %>%
slice(2) %>%
pull(prop) %>%
round(digits = 3) %>%
percent(accuracy = .1)
ws_all_hispanic_percent
wg_all_hispanic_percent
